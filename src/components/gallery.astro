---
const imageFiles = import.meta.glob('/public/assets/gallery/*.{jpg,png,svg,gif}')

const images = Object.entries(imageFiles).map(([path, resolver]) => {
	return resolver().then((module) => ({
		src: path,
		alt: path.split('/').pop().split('.')[0]
	}))
})

// Determine if the user is on a desktop or mobile (replace with actual logic)
const isDesktop = true // Replace with actual condition
const numberOfColumns = isDesktop ? 3 : 2
const imagesArray = await Promise.all(images)
const imagesPerColumn = Math.ceil(imagesArray.length / numberOfColumns)
let imageColumns = []
let imageIndex = 0

for (let x = 0; x < numberOfColumns; x++) {
	imageColumns.push(imagesArray.slice(imageIndex, imageIndex + imagesPerColumn))
	imageIndex += imagesPerColumn
}
---

<section>
	<div class="page-width row-top-x2 row-bottom-x2">
		<div class="title-container row-bottom-x2">
			<h2 class="text-white text-center">Gallery Section</h2>
		</div>
		<div class="row-top-x2 row-bottom-x2">
			<div class="video-container">
				<iframe
					id="vimeo-player"
					class="vimeo-player"
					width="1920"
					height="1080"
					src=""
					allow="autoplay; fullscreen"
					allowfullscreen></iframe>
			</div>
		</div>
		<div class="gallery-container">
			{
				imageColumns.map((column, index) => (
					<div class="gallery-column">
						{column.map((img) => (
							<div class="gallery-item">
								<img src={img.src} alt={img.alt} class="gallery-image" />
							</div>
						))}
					</div>
				))
			}
		</div>
	</div>
</section>

<style>
	section {
		min-height: 100vh;
		background-color: #000;
	}
	.gallery-container {
		display: flex;
		gap: 1rem;
		justify-content: center;
	}
	.gallery-column {
		flex: 1;
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}
	.gallery-image {
		width: 100%;
		height: auto;
		display: block;
	}
	.video-container {
		text-align: center;
		position: relative;
		width: 100%;
		padding-bottom: calc(9 / 16 * 100%); /* Aspect 16:9 */
		height: 0;
		overflow: hidden;
	}

	iframe {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		border: none;
	}

	@media (max-width: 640px) {
		.gallery-container {
			flex-direction: column;
		}
	}
</style>

<script>
	import Player from '@vimeo/player'

	const videoArray = [
		{
			url: 'https://vimeo.com/987289518'
		},
		{
			url: 'https://vimeo.com/987293628'
		},
		{
			url: 'https://vimeo.com/987294711'
		}
	]

	const videoId = videoArray[0].url.split('/').pop()

	document.addEventListener('DOMContentLoaded', () => {
		const vimeoPlayerElement = document.getElementById('vimeo-player') as HTMLIFrameElement

		if (!vimeoPlayerElement) {
			console.error('Vimeo player element not found.')
			return
		}

		vimeoPlayerElement.src = `https://player.vimeo.com/video/${videoId}?autoplay=1&muted=1&controls=0&loop=1`

		const player = new Player(vimeoPlayerElement)

		player.on('play', function () {
			console.log('Video is playing')
		})
	})
</script>
